generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int         @id @default(autoincrement())
  email     String      @unique
  password  String
  name      String
  phone     String?
  company   String?
  createdAt DateTime    @default(now())
  requests  Request[]
  equipment Equipment[]
}

model Setting {
  key   String @id
  value String @default("true")
}

model Request {
  id            Int      @id @default(autoincrement())
  name          String
  phone         String
  email         String
  company       String?
  inn           String?
  service       String
  object        String?
  fabricNumber  String?
  registry      String?
  poverk        String?
  message       String?
  fileName      String?
  filePath      String?
  status        String   @default("new")
  createdAt     DateTime @default(now())
  userId        Int?
  user          User?    @relation(fields: [userId], references: [id])
  adminNotes    String?
  executorPrice Float?
  markup        Float?
  clientPrice   Float?
  needContract  Boolean  @default(false)
  files         RequestFile[]
  items         RequestItem[]

  @@index([status])
  @@index([userId])
  @@index([createdAt])
}

model RequestFile {
  id        Int     @id @default(autoincrement())
  requestId Int
  request   Request @relation(fields: [requestId], references: [id], onDelete: Cascade)
  fileName  String
  filePath  String
}

model RequestItem {
  id           Int      @id @default(autoincrement())
  requestId    Int
  request      Request  @relation(fields: [requestId], references: [id], onDelete: Cascade)
  service      String
  poverk       String?
  object       String?
  fabricNumber String?
  registry     String?
}

model Service {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  price       Int
  image       String?
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Equipment {
  id                Int       @id @default(autoincrement())
  userId            Int
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  name              String
  type              String?
  serialNumber      String?
  registryNumber    String?
  verificationDate  DateTime?
  nextVerification  DateTime?
  interval          Int       @default(12)
  category          String    @default("verification")
  status            String    @default("active")
  notified          Boolean   @default(false)
  company           String?
  contactEmail      String?
  notes             String?
  arshinValidDate     DateTime?
  arshinMismatch      Boolean   @default(false)
  arshinCheckedAt     DateTime?
  arshinUrl           String?
  arshinNotifiedDate  DateTime?
  mitApproved         Boolean?
  mitUrl              String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([userId])
  @@index([nextVerification])
  @@index([status])
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  email     String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([token])
  @@index([email])
}

model PageView {
  id        Int      @id @default(autoincrement())
  url       String
  userAgent String?
  ip        String?
  userId    Int?
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([url])
}
